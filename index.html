<!DOCTYPE html>
<html>
<head>
  <title>Real-Time Chat App</title>
  <style>
    body { font-family: Arial, sans-serif; }
    #login-container, #chat-container { width: 300px; margin: 0 auto; display: none; }
    #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
    #messageInput { width: 100%; margin: 5px 0; }
    #sendButton { width: 100%; }
    .message { margin: 5px 0; }
    .message span { font-weight: bold; }
  </style>
</head>
<body>

  <!-- Login Section -->
  <div id="login-container">
    <input type="text" id="usernameInput" placeholder="Enter your username" />
    <button id="loginButton">Login</button>
  </div>

  <!-- Chat Section -->
  <div id="chat-container">
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button id="sendButton">Send</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBly6GLZW5vz4H4CRquPibhAjx7xWxbGKQ",
      authDomain: "munnamunni-65fa4.firebaseapp.com",
      databaseURL: "https://munnamunni-65fa4-default-rtdb.firebaseio.com",
      projectId: "munnamunni-65fa4",
      storageBucket: "munnamunni-65fa4.firebasestorage.app",
      messagingSenderId: "427977900003",
      appId: "1:427977900003:web:789c74bf6ddf8a0359ead6",
      measurementId: "G-704297800Z"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    const db = firebase.database();
    let username = '';
    let chatPartner = '';

    // Function to login
    function login() {
      const usernameInput = document.getElementById('usernameInput');
      username = usernameInput.value;
      if (username) {
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('chat-container').style.display = 'block';
        fetchMessages();
      }
    }

    // Function to start chatting with a specific user
    function startChatWith(user) {
      chatPartner = user;
      document.getElementById('messages').innerHTML = ''; // Clear the messages
      fetchMessages(); // Fetch messages with the new user
    }

    // Fetch and display messages from Firebase
    function fetchMessages() {
      db.ref('chats/' + getChatId()).on('child_added', (snapshot) => {
        const message = snapshot.val();
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML += `
          <div class="message">
            <span>${message.username}:</span> ${message.message}
          </div>
        `;
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
      });
    }

    // Generate a unique chat ID based on the usernames
    function getChatId() {
      return username < chatPartner ? username + "_" + chatPartner : chatPartner + "_" + username;
    }

    // Function to send a message
    function sendMessage() {
      const messageInput = document.getElementById('messageInput');
      const message = messageInput.value;
      if (message.trim()) {
        db.ref('chats/' + getChatId()).push().set({
          username: username,
          message: message,
          timestamp: Date.now()
        });
        messageInput.value = ''; // Clear input after sending
      }
    }

    // Event listeners
    document.getElementById('loginButton').addEventListener('click', login);
    document.getElementById('sendButton').addEventListener('click', sendMessage);

    // Simulating a user choosing to chat with someone
    setTimeout(() => startChatWith('user2'), 2000);  // Simulating chat with 'user2'
  </script>
</body>
</html>
